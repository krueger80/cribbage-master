<div class="flex flex-col gap-4 w-full">
    <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-500 w-fit">
        {{ 'HISTORY_VIEW.TITLE' | translate }}
    </h2>

    <div *ngIf="isLoading" class="text-slate-400 animate-pulse">
        {{ 'HISTORY_VIEW.LOADING' | translate }}
    </div>

    <div *ngIf="!isLoading && history.length === 0" class="text-slate-500 italic">
        {{ 'HISTORY_VIEW.NO_HISTORY' | translate }}
    </div>

    <div *ngIf="!isLoading && history.length > 0" class="flex flex-col gap-4">
        <div *ngFor="let item of history" class="card p-4 hover:border-emerald-500/50 transition-colors">

            <!-- Header: Timestamp + Info + Score -->
            <div class="flex justify-between items-start mb-4 border-b border-gray-200 dark:border-white/5 pb-2">
                <div class="flex flex-col gap-1">
                    <div class="flex items-center gap-2 text-xs text-slate-400 uppercase tracking-wider font-bold">
                        <span>{{ item.created_at | date:'short' }}</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-slate-500">
                        <span>{{ item.num_players }} {{ 'APP.PLAYERS' | translate }}</span>
                        <span>•</span>
                        <span>{{ (item.is_dealer ? 'APP.DEALER' : 'APP.NON_DEALER') | translate }}</span>
                    </div>
                </div>

                <div class="text-right flex flex-col items-end gap-1">
                    <button (click)="onRestore(item)"
                        class="text-[10px] bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-500 px-2 py-1 rounded uppercase font-bold tracking-wider transition-colors flex items-center gap-1">
                        <span>↻</span> {{ 'HISTORY_VIEW.REANALYZE' | translate }}
                    </button>

                    <div>
                        <span class="text-[10px] uppercase text-gray-500 font-bold tracking-wider">{{
                            'ANALYSIS_VIEW.EXPECTED' | translate }}</span>
                        <span class="text-3xl font-bold text-emerald-400 leading-none ml-2">{{ item.expected_value |
                            number:'1.1-1' }}</span>
                    </div>
                </div>
            </div>

            <!-- Cards Row (Single Line) -->
            <div class="flex items-center justify-center gap-3 overflow-x-auto pb-2">

                <!-- Kept Cards -->
                <div class="flex gap-1 flex-nowrap shrink-0">
                    <div *ngFor="let code of getKeptCards(item.original_hand, item.discarded)"
                        class="mini-card shadow-sm" [class.red]="getCardDetails(code).color === 'red'"
                        [class.black]="getCardDetails(code).color === 'black'">
                        <span class="font-bold">{{getCardDetails(code).rank}}</span>
                        <span>{{getCardDetails(code).symbol}}</span>
                    </div>
                </div>

                <!-- Arrow -->
                <div class="text-gray-400 text-xl mx-2 shrink-0">→</div>

                <!-- Discarded Cards -->
                <div class="flex gap-1 flex-nowrap shrink-0 opacity-70">
                    <div *ngFor="let code of item.discarded" class="mini-card border-red-900/10 bg-red-900/5"
                        [class.red]="getCardDetails(code).color === 'red'"
                        [class.black]="getCardDetails(code).color === 'black'">
                        <span class="font-bold">{{getCardDetails(code).rank}}</span>
                        <span>{{getCardDetails(code).symbol}}</span>
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>